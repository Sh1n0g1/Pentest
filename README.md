# Pentest memo for standalone box (like VulnHub, OSCP exam)
This is a short memo for the people who already knows the basic of the pentest.
This will not cover the Lateral Movement and only cover how to get shell and escalate privilege.
The example command is based on this environment.

TARGET HOST=192.241.248.137 
TARGET URL=https://shinobot.com
LOCAL HOST=59.106.208.91

# Initial Information Gathering
## Port Scan & Banner Grabbing
### nmap
**nmap -A 192.241.248.137**
```
Starting Nmap 6.40 ( http://nmap.org ) at 2020-02-15 12:00 JST
Nmap scan report for 192.241.248.137
Host is up (0.15s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey: 2048 e3:65:e9:f5:33:5a:01:20:c9:c5:4d:25:27:d2:1d:85 (RSA)
|_256 53:81:d7:76:08:8d:5b:b3:ea:94:5f:2b:60:53:62:1a (ECDSA)
80/tcp   open  http     Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips)
|_http-methods: No Allow or Public header in OPTIONS response (status code 302)
| http-title: ShinoBOT -the rat/bot malware simulator-
|_Requested resource was top.php
443/tcp  open  ssl/http Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips)
|_http-methods: No Allow or Public header in OPTIONS response (status code 302)
| http-title: ShinoBOT -the rat/bot malware simulator-
|_Requested resource was top.php
| ssl-cert: Subject: commonName=shinobot.com
| Not valid before: 2019-08-01T02:47:58+00:00
|_Not valid after:  2019-10-30T02:47:58+00:00
|_ssl-date: 2084-08-20T15:36:14+00:00; +64y187d12h35m27s from local time.
3306/tcp open  mysql    MySQL (unauthorized)
Aggressive OS guesses: Linux 2.6.32 - 3.9 (98%), Netgear DG834G WAP or Western Digital WD TV media player (96%), Linux 2.6.32 - 3.2 (95%), Linux 3.0 - 3.9 (95%), Linux 3.2 (93%), Linux 3.1 (93%), Linux 2.6.32 (93%), AXIS 210A or 211 Network Camera (Linux 2.6) (92%), Linux 2.6.32 - 2.6.35 (92%), Linux 2.6.32 - 3.6 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 13 hops

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   7.35 ms   59.106.208.2
2   0.96 ms   192.168.245.12
3   1.07 ms   tkdrt2b-sac-tk1a-rt11-2.bb.sakura.ad.jp (157.17.136.245)
4   0.57 ms   tkgrt1s-drt2b-2.bb.sakura.ad.jp (157.17.130.33)
5   0.85 ms   tkcrt2-wrt1s-2.bb.sakura.ad.jp (157.17.130.213)
6   1.28 ms   ce-0-14-0-3.r03.tokyjp05.jp.bb.gin.ntt.net (203.105.72.145)
7   0.99 ms   ae-4.r30.tokyjp05.jp.bb.gin.ntt.net (129.250.3.34)
8   1.29 ms   ce-0-14-0-3.r03.tokyjp05.jp.bb.gin.ntt.net (203.105.72.145)
9   1.15 ms   ae-4.r30.tokyjp05.jp.bb.gin.ntt.net (129.250.3.34)
10  151.60 ms ae-1.r01.nycmny17.us.bb.gin.ntt.net (129.250.4.41)
11  150.61 ms ce-0-13-0-2.r01.nycmny17.us.ce.gin.ntt.net (157.238.179.154)
12  153.96 ms ce-0-13-0-2.r01.nycmny17.us.ce.gin.ntt.net (157.238.179.154)
13  148.88 ms 192.241.248.137

OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.72 seconds

```
We extract the open port and service and the OS version for the further steps.
```
22/tcp   open  ssh      OpenSSH 7.4 (protocol 2.0)
80/tcp   open  http     Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips)
443/tcp  open  ssl/http Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips)
3306/tcp open  mysql    MySQL (unauthorized)

Aggressive OS guesses: Linux 2.6.32 - 3.9 (98%), Netgear DG834G WAP or Western Digital WD TV media player (96%), Linux 2.6.32 - 3.2 (95%), Linux 3.0 - 3.9 (95%), Linux 3.2 (93%), Linux 3.1 (93%), Linux 2.6.32 (93%), AXIS 210A or 211 Network Camera (Linux 2.6) (92%), Linux 2.6.32 - 2.6.35 (92%), Linux 2.6.32 - 3.6 (92%)
```

## Web Directory Scanning
### Konan
**python konan.py -uhttp://192.241.248.137/**
```
/root/Konan
--------------------------------------------------
Konan (0.1) - Advanced Web Application Dir Scanner
by: Momo (mallok) Outaadi (github.com/m4ll0k)
--------------------------------------------------

URL: http://192.241.248.137/

PERCENT  -   TIME   - CODE  -   METHOD  - LENGTH - URL
-------------------------------------------------------
/root/Konan/db/dict.txt
0.04%    - 12:31:32 -  302  -   GET     -  0       - http://192.241.248.137/?:  -> top.php
22.54%   - 12:46:48 -  302  -   GET     -  0       - http://192.241.248.137/control.php  -> hosts.php
46.57%   - 13:03:08 -  403  -   GET     -  206     - http://192.241.248.137/.hta
46.59%   - 13:03:09 -  403  -   GET     -  211     - http://192.241.248.137/.htaccess
46.59%   - 13:03:09 -  403  -   GET     -  212     - http://192.241.248.137/.htaccess~
46.60%   - 13:03:09 -  403  -   GET     -  211     - http://192.241.248.137/.htaccess
46.61%   - 13:03:10 -  403  -   GET     -  215     - http://192.241.248.137/.htaccess.bak
46.63%   - 13:03:11 -  403  -   GET     -  214     - http://192.241.248.137/.htaccessBAK
46.64%   - 13:03:11 -  403  -   GET     -  215     - http://192.241.248.137/.htaccess.BAK
46.64%   - 13:03:11 -  403  -   GET     -  216     - http://192.241.248.137/.htaccess.bak1
46.65%   - 13:03:12 -  403  -   GET     -  215     - http://192.241.248.137/.htaccess-dev
46.67%   - 13:03:12 -  403  -   GET     -  217     - http://192.241.248.137/.htaccess_extra
46.67%   - 13:03:12 -  403  -   GET     -  215     - http://192.241.248.137/.htaccess.inc
46.68%   - 13:03:13 -  403  -   GET     -  217     - http://192.241.248.137/.htaccess-local
46.69%   - 13:03:13 -  403  -   GET     -  217     - http://192.241.248.137/.htaccess-marco
46.70%   - 13:03:13 -  403  -   GET     -  215     - http://192.241.248.137/.htaccess.old
46.71%   - 13:03:14 -  403  -   GET     -  214     - http://192.241.248.137/.htaccessOLD
46.72%   - 13:03:14 -  403  -   GET     -  215     - http://192.241.248.137/.htaccessOLD2
46.73%   - 13:03:15 -  403  -   GET     -  216     - http://192.241.248.137/.htaccess_orig
46.73%   - 13:03:15 -  403  -   GET     -  216     - http://192.241.248.137/.htaccess.orig
46.74%   - 13:03:15 -  403  -   GET     -  218     - http://192.241.248.137/.htaccess.sample
46.75%   - 13:03:15 -  403  -   GET     -  216     - http://192.241.248.137/.htaccess.save
46.76%   - 13:03:16 -  403  -   GET     -  214     - http://192.241.248.137/.htaccess_sc
46.76%   - 13:03:16 -  403  -   GET     -  215     - http://192.241.248.137/.htaccess.txt
46.80%   - 13:03:18 -  403  -   GET     -  210     - http://192.241.248.137/.htgroup
46.91%   - 13:03:22 -  403  -   GET     -  211     - http://192.241.248.137/.htpasswd
46.92%   - 13:03:22 -  403  -   GET     -  211     - http://192.241.248.137/.htpasswd
46.93%   - 13:03:23 -  403  -   GET     -  215     - http://192.241.248.137/.htpasswd.bak
46.95%   - 13:03:24 -  403  -   GET     -  215     - http://192.241.248.137/.htpasswd.inc
46.96%   - 13:03:24 -  403  -   GET     -  215     - http://192.241.248.137/.htpasswd-old
46.96%   - 13:03:24 -  403  -   GET     -  212     - http://192.241.248.137/.htpasswds
46.97%   - 13:03:25 -  403  -   GET     -  216     - http://192.241.248.137/.htpasswd_test
46.98%   - 13:03:25 -  403  -   GET     -  212     - http://192.241.248.137/.htpasswrd
47.10%   - 13:03:30 -  403  -   GET     -  210     - http://192.241.248.137/.htusers
47.10%   - 13:03:30 -  403  -   GET     -  213     - http://192.241.248.137/.ht_wsr.txt
49.22%   - 13:04:56 -  302  -   GET     -  0       - http://192.241.248.137/index.php  -> top.php
49.28%   - 13:04:59 -  302  -   GET     -  0       - http://192.241.248.137/index.php/login  -> top.php
100.00%  - 13:39:25
Task Completed
```

## nikto
**$perl nikto.pl -host https://shinobot.com/**
```
- ***** SSL support not available (see docs for SSL install) *****
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.241.248.137
+ Target Hostname:    shinobot.com
+ Target Port:        443
---------------------------------------------------------------------------
+ SSL Info:        Subject:  /CN=shinobot.com
                   Ciphers:  ECDHE-RSA-AES256-GCM-SHA384
                   Issuer:   /C=US/O=Let's Encrypt/CN=Let's Encrypt Authority X3
+ Start Time:         2020-02-15 19:17:55 (GMT9)
---------------------------------------------------------------------------
+ Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Root page / redirects to: top.php
+ OpenSSL/1.0.2k-fips appears to be outdated (current is at least 1.1.1d). OpenSSL 1.0.0o and 0.9.8zc are also current.
+ Apache/2.4.6 appears to be outdated (current is at least Apache/2.4.41). Apache 2.2.34 is the EOL for the 2.x branch.
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-3093: /db.php: This might be interesting:  has been seen in web logs from an unknown scanner.
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ /help.php: A help file was found.
+ 8739 requests: 0 error(s) and 10 item(s) reported on remote host
+ End Time:           2020-02-15 19:41:28 (GMT9) (1413 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested

```

# Exploitation (Getting Shell)
## Web
### RFI / LFI
### OS Command Injection
### SQL Injection


# Privilege Escalation
## Scanner
## CVE
### DirtyCow


<hr>

# How to setup the Pentest machine
## Install nmap
```
sudo apt-get install -y nmap
sudo yum install -y nmap
```
## Install nikto
The zip file is linked from https://cirt.net/Nikto2.
```
sudo yum install openssl-devel perl perl-Net-SSLeay perl-Crypt-SSLeay
sudo apt-get install perl libnet-ssleay-perl openssl libauthen-pam-perl libio-pty-perl libmd5-perl

wget https://github.com/sullo/nikto/archive/master.zip
unzip master.zip
```
## Install Konan
```
git clone https://github.com/m4ll0k/Konan.git
cd Konan
pip install -r requirements.txt
pip install pathlib
```
